SHELL=/bin/sh
INSTALL=@INSTALL@
INSTALL_PROGRAM=@INSTALL_PROGRAM@
PREFIX=@PREFIX@
HOST=@HOST@
CP=cp -p
MKDIR=mkdir -p

GNATMAKE=gnatmake
ifeq ($(strip $(filter-out %vms%,$(HOST))),)
GNATMAKE=${GNATMAKE} -XOS=vms
endif

all: obj/gprmake_dummies.o force
	${GNATMAKE} -Pgprconfig
	${GNATMAKE} -Pgprconfig gprmake gprbind gprlib gprclean

install: all
	${MKDIR} ${PREFIX}/bin
	${MKDIR} ${PREFIX}/libexec/gprmake
	${MKDIR} ${PREFIX}/share/gpr
	${MKDIR} ${PREFIX}/share/gprconfig
	${INSTALL_PROGRAM} gprconfig ${PREFIX}/bin
	${INSTALL_PROGRAM} gprmake ${PREFIX}/bin
	${INSTALL_PROGRAM} gprclean ${PREFIX}/bin
	${INSTALL_PROGRAM} gprbind ${PREFIX}/libexec/gprmake/
	${INSTALL_PROGRAM} gprlib ${PREFIX}/libexec/gprmake/
	${INSTALL_PROGRAM} create_ada_runtime_project ${PREFIX}/libexec/gprmake/
	${CP} share/gprconfig/*.xml ${PREFIX}/share/gprconfig
	${CP} share/gprconfig/gnat_runtime.mapping ${PREFIX}/share/gprconfig

obj/gprmake_dummies.o: src/gprmake_dummies.c
	gcc -c -o $@ $<

clean_doc:
	@cd doc; ${RM} gprconfig.cp gprconfig.log gprconfig.ky gprconfig.toc
	@cd doc; ${RM} gprconfig.aux gprconfig.fn gprconfig.pg
	@cd doc; ${RM} gprconfig.tp gprconfig.cps gprconfig.vr

clean: clean_doc
	gnat clean -q -r -Pgprconfig
	@${RM} standard_foo.gpr doc/gprconfig.pdf

distclean: clean
	@${RM} config.log config.status src/gprconfig-sdefault.ads gnat.gpr
	@${RM} Makefile

doc: doc/gprconfig.pdf
doc/gprconfig.pdf: doc/gprconfig.texi
	cd doc; echo x | texi2dvi -p gprconfig.texi
	${MAKE} clean_doc

tests: all force
	cd tests; ./test.cmd

force:

