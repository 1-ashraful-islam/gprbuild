======================================
Known problems in GPRBUILD version 2.3
======================================

Copyright (C) 2015-2016, AdaCore

The following is a listing of known problems in releases 2.3.1 and 2.3.2.
Each entry contains a status line stating when the problem was fixed, and on
which release(s). In addition, any wavefront issued subsequent to the date
specified (in ISO format YYYY-MM-DD) also contains the fix. This can be used
to determine if a given release or wavefront has the fix identified in the
entry.

Note that older releases might or might not be affected by the problems listed
in this document.

Known problems fixed in 17.1 and above
--------------------------------------

KP-23-P802-010 String type from another missing project

  Problem:    gprbuild may crash when a string type declared in a missing
              project is referenced in the declaration of a string typed
              variable.

  Status:     This was fixed in 17 on 2016-08-05

  Workaround: Make sure that the project is not missing.

KP-23-P727-004 Artifacts for binder generated sources not cleaned

  Problem:    The artifacts created when compiling the binder generated
              sources are not cleaned by gprclean.

  Status:     This was fixed in 17 on 2016-07-27

  Workaround: Delete the artifacts manually.

KP-23-P726-007 CodePeer mode and switch -s

  Problem:    In CodePeer mode, switch -s (for checking compilation switches)
              is inhibited.

  Status:     This was fixed in 17 on 2016-07-26

  Workaround: Use switch -f instead of -s.

KP-23-P726-003 Subunits and ALI_Closure

  Problem:    When the dependency kind is ALI_Closure and there are subunits
              in the closure, gprbuild tries to read ALI files for the
              subunits. This may result in unneeded recompilations.

  Status:     This was fixed in 17 on 2016-07-28

  Workaround: Let gprbuild recompile or do not use subunits.

KP-23-P725-011 GPRinstall and separate unit

  Problem:    GPRinstall fails to install a project containing a separate
              unit.

  Status:     This was fixed in 17 on 2016-07-25

  Workaround: Install the project manually.

KP-23-P630-028 Aggregate library and read-only object directories

  Problem:    When some component projects of an aggregate library have their
              object directories read-only, gprbuild may fail to build the
              library, as it is unable to create the library exchange file.

  Status:     This was fixed in 17 on 2016-07-06

  Workaround: Make the object directories writeable.

KP-23-P629-043 Extending all SAL and imported projects

  Problem:    When a Stand-Alone Library project X extends all another project
              B that imports another project P and sources of project P are
              already compiled, binding the SAL may fail because some ALI files
              from project P are not found.

  Status:     This was fixed in 17 on 2016-07-05

  Workaround: Invoke gprbuild with -f to force recompilation of sources of
              imported project P.

KP-23-P620-013 Expanded linker options

  Problem:    Linker options that look like relative paths or include relative
              paths (such as "toto.o" or "-Ldir") are expanded to absolute
              paths, even if the file or directory does not exist.

  Status:     This was fixed in 17 on 2016-06-25

  Workaround: Specify the option directly to the linker with a switch
              "-Wl,...".

KP-23-P616-027 Duplicate object files in Stand-Alone Library

  Problem:    Binding of a Stand-Alone Library may fail when the library
              project extends another library project, the sources of the
              extending project are the same as those of the project being
              extended and there are naming declarations in package Naming
              for the Ada sources.

  Status:     This was fixed in 17 on 2016-06-20

  Workaround: Avoid using the same sources for the extending project and
              the project being extended.

KP-23-P606-054 Spurious requirement for a body when building a SAL

  Problem:    GPRBuild incorrectly expects unit U to be part of the interface
              set of a SAL (Standalone Shared Library) when a generic unit with
              a nested generic subprogram is instantiated in unit M, the
              instantiation is followed by a generic subprogram renaming of the
              nested generic subprogram defined in the instance, the body of M
              has a with clause on U, and the associated project file does not
              list U in the Library_Interface set for the SAL.

  Status:     This was fixed in 17 on 2016-06-08

  Workaround: Remove the generic subprogram renaming or include U in the
              Library_Interface set for the SAL.

KP-23-P531-017 Interfaces in projects aggregated by aggregate SAL project

  Problem:    When a project aggregated by an aggregate Stand-Alone Library
              project declare attribute Interfaces, building the aggregate
              library may fail with an indication that the interface is
              not complete.

  Status:     This was fixed in 17 on 2016-06-02

  Workaround: Use attribute Library_Interface instead of Interfaces.

KP-23-P525-002 Endless loop with unfinished string in project file

  Problem:    When in a project file there is a string with a missing
              double quote, gprbuild may crash or end in an endless loop.

  Status:     This was fixed in 17 on 2016-06-11

  Workaround: Fix the project file.

KP-23-P508-004 gprls crashes when object directory does not exist

  Problem:    gprls crashes when invoked for a project that specifies an object
              directory that does not exist.

  Status:     This was fixed in 17 on 2016-05-09

  Workaround: Create the object directory before invoking gprls.

KP-23-P503-049 Extending installed library projects

  Problem:    When a project extends an installed library project, gprbuild
              may fail to build the library for the extended project.

  Status:     This was fixed in 17 on 2016-05-05

  Workaround: Do not extend the installed project; copy its sources in a
              standard project, then modify the sources.

KP-23-P428-028 Static SALs and Library_Standalone is "standard"

  Problem:    In a static Stand Alone Library project, it is not allowed to
              declare
                  for Library_Standalone use "standard";

  Status:     This was fixed in 17 on 2016-04-28

  Workaround: Do not use such declaration in static SAL projects.

KP-23-P427-070 Aggregated abstract and non externally built projects

  Problem:    Abstract projects are allowed to be component projects of
              aggregate projects. Also, project that declare Externally_Built
              to be "false" are not allowed to be component projects.

  Status:     This was fixed in 17 on 2016-04-27

  Workaround: Do not aggregate abstract projects. Remove declaration of
              Externally_Built is "false" in aggregated projects.

KP-23-P419-029 Spaces in dependency paths of file based languages

  Problem:    When the path of a dependency file, stored in a .d dependency
              file includes spaces, the source is always recompiled, even when
              it is up to date.

  Status:     This was fixed in 17 on 2016-05-23

  Workaround: Avoid directories with spaces.

KP-23-P418-032 Aggregate projects and mains on the command line

  Problem:    When gprbuild is invoked for an aggregate project and one or
              several mains on the command line, all the sources of the
              aggregated projects that do not have any of the mains as source
              are compiled.

  Status:     This was fixed in 17 on 2016-04-15

  Workaround: Invoke gprbuild on the aggregate projects with the mains.

KP-23-P415-001 GPRinstall fails to install aggregate libraries

  Problem:    When an aggregate library contains some variables, GPRinstall
              fails to install it correctly. The installed project is not
              usable.

  Status:     This was fixed in 17 on 2016-04-19

  Workaround: Install the aggregated projects one by one.

KP-23-P414-012 Failure to link shared Stand Alone Libraries

  Problem:    In some cases, shared Stand Alone Libraries cannot be linked,
              when the length of the command line is long enough so that
              a response file is used, the linker driver is g++ and there are
              additional switches.

  Status:     This was fixed in 17 on 2016-04-26

  Workaround: Reduce the length of the command line or increase the value of
              attribute Max_Command_Line_Length.

KP-23-P412-026 Variable in case construction in package

  Problem:    The Project Manager does not allow a variable declaration inside
              a case construction in a package if the variable has been
              declared at the project level.

  Status:     This was fixed in 17 on 2016-04-14

  Workaround: Declare the variable in the package before the case construction.

KP-23-P406-010 Non existent external reference with no default

  Problem:    external ("<reference>") gives value of empty string when
              <reference> does not exist, instead of giving an error.

  Status:     This was fixed in 17 on 2016-04-16

  Workaround: Use external with a default.

KP-23-P309-051 Imported projects may be order dependent

  Problem:    When the main project is an "extending all" project and it
              imports extending projects, with some order of the with clauses
              gprbuild may report that an extending project is directly
              imported.

  Status:     This was fixed in 17 on 2016-05-13

  Workaround: Reorder the with clauses to find one that works.

KP-23-P204-036 gprclean not cleaning .ci files

  Problem:    gprclean was not cleaning the .ci files in the object
              directories. Those files are created when the Ada compiler is
              invoked with switch -fcallgraph-info=su

  Status:     This was fixed in 17 on 2016-02-19

  Workaround: Delete manually the .ci files.

KP-23-P204-036 Crash on MacOS with NFS mounted directories

  Problem:    GPRbuild may crash on MacOS when the main is in C or C++, the
              object directory is NFS mounted and all the Ada sources are in
              Stand-Alone Libraries.

  Status:     This was fixed in 17 on 2016-08-06

  Workaround: Use an object directory that is not NFS mounted.

KP-23-P125-003 Standalone library with child units installation issue

  Problem:    GPRinstall won't install a compilable standalone library
              project if a child unit is part of the interface.

  Status:     This was fixed in 17 on 2016-01-25

  Workaround: Fix manually the generated Library_Interface attribute.

KP-23-P112-067 Included_Artifact_Patterns ignored

  Problem:    The GPRbuild distributed attribute Included_Artifact_Patterns
              is not taken into account.

  Status:     This was fixed in 17 on 2016-01-20

  Workaround: Copy manually the artifacts from the slaves (e.g using rsync)

KP-23-OC11-012 Aggregate project and mains on the command line

  Problem:    When gprbuild is invoked with an aggregate project and one
              or several mains on the command line, all the sources of
              the projects without a main are compiled. They should not be
              compiled.

  Status:     This was fixed in 17 on 2016-04-26

  Workaround: Invoked gprbuild on the aggregated projects instead of on the
              aggregate project.

KP-23-OB30-037 GPRinstall fails installing main with specific naming

  Problem:    When the Main attribute was specified without extension and
              the Binder's Executable attribute with an extension the
              specified name was not found. In this case GPRinstall failed
              as it was not able to find the executable to install.

  Status:     This was fixed in 17 on 2015-12-05

  Workaround: Install the main with standard tools.

KP-23-OB20-022 GPRslave could run into an endless loop

  Problem:    In some rare cases, GPRslave could be stuck in an endless loop
              after an interrupted build.

  Status:     This was fixed in 17 on 2015-11-25

  Workaround: Avoid interrupting distributed builds.

KP-23-OB20-001 Encapsulated libraries and external libraries

  Problem:    When building an encapsulated library importing (directly or
              indirectly) projects with a Linker_Options, the encapsulated
              library fails to build because of undefined symbols.

  Status:     This was fixed in 17 on 2015-11-22

  Workaround: Add the necessary options into the Library_Options of the
              encapsulated library.

KP-23-OB10-028 Shared libraries importing static libraries

  Problem:    When a shared library project imports an abstract project that
              itself imports static libraries, the Project Manager does not
              report an error, as it should.

  Status:     This was fixed in 17 on 2015-11-10

  Workaround: Import directly the static libraries.

KP-23-OB09-005 Crash when project path is too large

  Problem:    gprbuild crashes when the project path is too large, for example
              when environment variable GPR_PROJECT_PATH_FILE points to
              a text file with more than 33,000 characters.

  Status:     This was fixed in 17 on 2015-11-09

  Workaround: Reduce the number of directories in the project path.

KP-23-OA14-025 Failure in parallel invocations of gprbuild

  Problem:    When several parallel invocations of gprbuild, using the same
              directory to store temporary files (for example with the same
              value of environment variable TMPDIR), some of these invocations
              may fail, because a temporary file cannot be found or has an
              incorrect content.

  Status:     This was fixed in 17 on 2016-04-05

  Workaround: Repeat the invocation of gprbuild that failed.

KP-23-OA09-019 Switches in package Clean not taken into account

  Problem:    gprclean does not take into account the Switches in package
              Clean of the main project.

  Status:     This was fixed in 17 on 2016-04-06

  Workaround: Use only switches on the command line.

Known problems fixed in 2.3.2 and above
---------------------------------------

KP-23-OC21-017 Restricted languages and auto configuration

  Problem:    When gprbuild is invoked with switches --restricted-to-languages=
              or --codepeer, the languages that should be used for the
              invocation of gprconfig in auto configuration are the restricted
              languages.
              In CodePeer mode, the only language to consider is Ada.

  Status:     This was fixed in 17 on 2015-12-21
              This was fixed in 2.3.2 on 2015-05-19

  Workaround: Do not declare languages other than the restricted ones.

KP-23-OC17-040 Index case-sensitivity for attribute Global_Compilation_Switches

  Problem:    When the value of attribute Builder'Global_Compilation_Switches
              is asked through GNATCOLL.Projects.Attribute_Value, the wrong
              result may be returned as the index is incorrectly
              case-sensitive.

  Status:     This was fixed in 17 on 2015-12-26
              This was fixed in 2.3.2 on 2016-05-19

  Workaround: Use the exact same language name as in the declaration in the
              project file.
