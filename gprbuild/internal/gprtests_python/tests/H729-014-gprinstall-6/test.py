import os
from gprbuild_utils import *

def print_inst(lines):
    print lines[0]

    # cp or ln lines to be sorted
    cp=[]
    # remaining lines
    r=[]
    for l in lines[1:]:
        if l[0:3] == 'cp ' or l[0:3] == 'ln ':
            cp = cp + [l]
        else:
            r = r + [l]

    cp.sort()
    for l in cp:
        print l.replace('\\', '/').replace('.dll', '.so').replace('.dylib', '.so')
    for l in r:
        if l[0:49] == '--  This project has been generated by GPRINSTALL':
            print l[0:49]
        else:
            print l.replace('\\', '/')

gprbuild ('prj/lib.gpr')

gprinstall (['--no-lib-link', '-m', '--prefix=/opt', '--dry-run',
             'prj/lib.gpr'], output='tmp1.out', verbose=True)
print "=== 1"
print_inst(open('tmp1.out').readlines())

gprinstall (['--no-lib-link', '-m', '--prefix=/opt', '--dry-run',
             'prj/libi.gpr'], output='tmp2.out', verbose=True)
print "=== 2"
print_inst (open('tmp2.out').readlines())
